#!/usr/bin/env php
<?php

require __DIR__ . '/../vendor/autoload.php';

use Symfony\Component\Console\Application;
use Symfony\Component\Console\Command\Command;
use Symfony\Component\Console\Formatter\OutputFormatterStyle;

use micmania1\SilverStripeCli\Console\Output;

define('ROOT_DIR', dirname(__DIR__));
define('COMPOSER_BIN', ROOT_DIR . '/vendor/bin/composer');
define('FIXTURES_DIR', ROOT_DIR . '/fixtures');
define('CLI_ASSETS', ROOT_DIR . '/cli-assets');

$application = new Application();
$application->setName('SilverStripe Cli');
$application->setVersion('0.1-experimental');

// Register all of our commands
$commands = glob(__DIR__ . '/../src/Commands/*.php');
foreach($commands as $command) {
	$pos = strrpos($command, DIRECTORY_SEPARATOR);
	if(is_int($pos)) {
		$pos++;
	} else {
		$pos = 0;
	}

	$namespace = '\\micmania1\\SilverStripeCli\\Commands\\';
	$class = $namespace . substr($command, $pos, -4);
	if(class_exists($class) && is_a($class, Command::class, true)) {

		$cmd = new $class;
		$application->add($cmd);

		if($cmd->getName() == 'silverstripe') {
			$application->setDefaultCommand($cmd->getName());
		}
	}
}

$output = new Output();

$successStyle = new OutputformatterStyle('white', 'green');
$output->getFormatter()->setStyle('success', $successStyle);

$application->run(null, $output);
